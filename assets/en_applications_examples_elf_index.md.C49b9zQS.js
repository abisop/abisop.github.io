import{_ as o,c as t,al as i,o as a}from"./chunks/framework.NFAqBSgQ.js";const u=JSON.parse('{"title":"elf ELF loader","description":"","frontmatter":{},"headers":[],"relativePath":"en/applications/examples/elf/index.md","filePath":"en/applications/examples/elf/index.md"}'),l={name:"en/applications/examples/elf/index.md"};function d(s,e,r,n,c,m){return a(),t("div",null,e[0]||(e[0]=[i(`<h1 id="elf-elf-loader" tabindex="-1"><code>elf</code> ELF loader <a class="header-anchor" href="#elf-elf-loader" aria-label="Permalink to &quot;\`elf\` ELF loader&quot;">​</a></h1><p>This example builds a small ELF loader test case. This includes several test programs under <code>examples/elf</code> tests. These tests are build using the relocatable ELF format and installed in a configurable file system. At run time, the file system is mounted and each program is executed. Requires <code>CONFIG_ELF</code>. Two distinct types of file systems are supported: internal (included in the NuttX binary) and external (not included in the binary). The external file systems need to be uploaded manually. For the internal file systems the sample supports the <code>romfs</code> and <code>cromfs</code> filesystems. For the external file systems any of the provided file systems can be used (<code>vfat</code>, ...), but also the <code>romfs</code> filesystem for which the image (<code>romfs.img</code>) is automatically generated.</p><p>Configuration options:</p><ul><li><code>CONFIG_EXAMPLES_ELF_DEVMINOR</code> – The minor device number of the ROMFS block driver. For example, the <code>N</code> in <code>/dev/ramN</code>. Used for registering the RAM block driver that will hold the ROMFS file system containing the ELF executables to be tested. Default: <code>0</code>.</li><li><code>CONFIG_EXAMPLES_ELF_DEVPATH</code> – The path to the ROMFS block driver device. This must match <code>EXAMPLES_ELF_DEVMINOR</code>. Used for registering the RAM block driver that will hold the ROMFS file system containing the ELF executables to be tested. Default: <code>/dev/ram0</code>.</li></ul><p><strong>Notes</strong>:</p><ol><li><p><code>CFLAGS</code> should be provided in <code>CELFFLAGS</code>. RAM and FLASH memory regions may require long allcs. For ARM, this might be:</p><pre><code>CELFFLAGS = (CFLAGS) -mlong-calls
</code></pre><p>Similarly for C++ flags which must be provided in <code>CXXELFFLAGS</code>.</p></li><li><p>Your top-level <code>nuttx/Make.defs</code> file must also include an appropriate definition, <code>LDELFFLAGS</code>, to generate a relocatable ELF object. With GNU LD, this should include <code>-r</code> and <code>-e main</code> (or <code>_main</code> on some platforms).:</p><pre><code>LDELFFLAGS = -r -e main
</code></pre><p>If you use GCC to link, you make also need to include <code>-nostdlib</code>.</p></li><li><p>ELF size: The ELF files in this example are, be default, quite large because they include a lot of build garbage. You can greatly reduce the size of the ELF binaries are using the <code>objcopy --strip-unneeded</code> command to remove un-necessary information from the ELF files.</p></li><li><p>Simulator. You cannot use this example with the NuttX simulator on Cygwin. That is because the Cygwin GCC does not generate ELF file but rather some Windows-native binary format.</p><p>If you really want to do this, you can create a NuttX x86 buildroot toolchain and use that be build the ELF executables for the ROMFS file system.</p></li><li><p>Linker scripts. You might also want to use a linker scripts to combine sections better. An example linker script is at <code>nuttx/binfmt/elf/gnu-elf.ld</code>. That example might have to be tuned for your particular linker output to position additional sections correctly. The GNU LD <code>LDELFFLAGS</code> then might be:</p><pre><code>LDELFFLAGS = -r -e main -T(TOPDIR)/binfmt/elf/gnu-elf.ld
</code></pre></li><li><p>When generating the <code>romfs.img</code> for external filesystem the image (<code>romfs.img</code>) needs to be manually copied to the start of the configured <code>CONFIG_EXAMPLES_ELF_DEVPATH</code> using <code>openocd</code> or your preferred programmer.</p></li></ol>`,6)]))}const h=o(l,[["render",d]]);export{u as __pageData,h as default};
